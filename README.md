# Практическое задание №3

- Определить какой-нибудь внешний источник получения данных и способ получения этих данных (http, curl, wget, API, SQL, SparQL, ...) 
- Поставить задачу для алгоритма машинного обучения, выбрать модель и метрику 
- Создать инфраструктуру, например, виртуальные машины virtualbox, установить и настроить для работы необходимое программное обеспечение, в том исле airflow и mlflow, а также venv для организации работы виртуального окружения 
- Создать python скрипты для 
    - Получения данных из внешнего источника 
    - Преобразования данных 
    - Формирования рабочего набора данных для обучения (train) и тестирования (test) модели 
    - Обучения модели на тренировочных (train) данных и ее сохранения 
    - Загрузки модели и проверки качества ее работы на тестовых (test) данных 
- Добавить код airflow, позволяющий создавать и запускать на регулярной основе описанные операции проекта. 
- Добавить код mlflow, позволяющий мониторить ход выполнения конвейера, сохранять и анализировать полученных артифакты. 


Задача заключается в сборе данных и их обработке, а также последующем обучении модели ML. Airflow используется для автоматизации операций, а MLFlow для мониторинга процессов.

В данной работе мы собираем информацию о рейтинге канала по колличеству лайков на видео из доступных открытых источников, а именно youtube.ru

1. Создание файловой структуры и виртуального окружения

Также было создано виртуальное откружение с версией питона 3.8

![image](https://github.com/Marakya/xflow/assets/113238801/c684f8b4-3d6f-4626-8f27-dd2498d146d0)


2. Airflow

   Установка и выполнение необходимых команд:
   ```
   pip install "apache-airflow[celery]==2.7.3" --constraint "https://raw.githubusercontent.com/apache/airflow/constraints-2.7.3/constraints-3.8.txt"
   export AIRFLOW_HOME=/home/xflow/project/airflow
   airflow db init
   ```
   Запуск
   
   ![image](https://github.com/Marakya/xflow/assets/113238801/0e67471c-aa83-4317-b519-a659239f8926)

   Запускаем в новом окне Scheduler для выполнения команд по расписанию и отслеживания новых скрпитов в папке dags. Также перед запуском необходимо установить значение переменной окружения AIRFLOW_HOME
   
   ![image](https://github.com/Marakya/xflow/assets/113238801/87a5a587-ab5c-49fe-96e3-d68b967cc3a8)


   В папке dags создаем скрипт (youtube_comments_score.py), который с использованием BashOperator вызывает выполнение python скриптов (в папке scripts) и объединяет эти операторы в конвейер оператором >>.
   
   ![image](https://github.com/Marakya/mlops_xflow/assets/113238801/53697202-2f12-403a-acae-ecf7077c0427)

   В итоге, запустив конвейер операций на выполнение, мы увидим успешно выполненную задачу.

   ![image](https://github.com/Marakya/xflow/assets/113238801/1b679fd1-5795-4a20-9a93-6d335b2c20db)

   ![image](https://github.com/Marakya/xflow/assets/113238801/da110cc3-ad62-4609-a3d6-01ce8e702584)


4. Mlflow

   Организуем мониторинг выполнения всех операций проекта с использованием MLFlow.

   Необходимый код для установки:
   ```
   pip install mlflow
   export MLFLOW_REGISTRY_URI=mlflow
   ```
   
   ![image](https://github.com/Marakya/xflow/assets/113238801/d00320c1-80f5-4154-bf92-8126521aabbe)


   Также в скриптах необходимо установить нужные нам объекты под наблюдение mlflow
   
   Поскольку мы сохранили код python скрипта как артифакт функцией mlflow.log_artifact, мы можем посмотреть этот код в графическом интерфейсе mlflow.
   
   Например, в скрипте train_model.py, мы сохранили следующее
   
   ![image](https://github.com/Marakya/mlops_xflow/assets/113238801/c92ff840-48fe-45e2-a1e8-2094dd98d2dd)

   ![image](https://github.com/Marakya/xflow/assets/113238801/1e583f9d-7c97-4756-85ee-07d6a2fdba19)

   ![image](https://github.com/Marakya/xflow/assets/113238801/6113987e-4d52-4b19-ba61-2d6ab897b7d6)
   
   ![image](https://github.com/Marakya/xflow/assets/113238801/51d2848b-07b9-4098-8338-8676d11e98c2)

   Здесь также можно найти артефакты 
   ![image](https://github.com/Marakya/xflow/assets/113238801/a2ab59e3-3b0c-4ae7-8695-d125a9c2b8be)

   
